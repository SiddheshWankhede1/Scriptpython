name: Run Delete Query

on:
  push:
    branches:
      - main  # adjust this to your main branch name

jobs:
  delete_query:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.8  # choose the appropriate Python version

    - name: Install dependencies
      run: pip install psycopg2-binary  # install psycopg2

    - name: Run Python script
      run: python script.py
      env:
        DATABASE_HOST: 127.0.0.1
        DATABASE_PORT: 5432  
        DATABASE_NAME: credentials  
        DATABASE_USER: postgres
        DATABASE_PASSWORD: Jtrip23@
    - name: Retry connecting to PostgreSQL
      id: connect
      run: |
          for i in {1..5}; do
            psql -h 127.0.0.1 -U your_username -d your_database -c 'SELECT 1;' && break || sleep 5;
          done

    - name: Check connection status
      run: |
          if [ ${{ steps.connect.exitcode }} -eq 0 ]; then
            echo "Connection successful."
          else
            echo "Error: Connection failed after multiple attempts."
            exit 1
          fi
